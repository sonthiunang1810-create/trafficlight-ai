<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö¶ H·ªá Th·ªëng ƒê√®n Giao Th√¥ng Th√¥ng Minh AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #eee;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            font-weight: 300;
        }
        
        .simulation-area {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .simulation-area {
                grid-template-columns: 1fr;
            }
        }
        
        .traffic-canvas-container {
            background: #2c3e50;
            border-radius: 15px;
            padding: 20px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
        }
        
        #trafficCanvas {
            width: 100%;
            height: 500px;
            background: #34495e;
            border-radius: 10px;
            display: block;
        }
        
        .control-panel {
            background: #ecf0f1;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .light-indicator {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .light-state {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
            text-transform: uppercase;
        }
        
        .state-red { color: #e74c3c; }
.state-green { color: #27ae60; }
        .state-yellow { color: #f39c12; }
        
        .timer {
            font-size: 3em;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .priority-alert {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 15px 0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .log-container {
            background: #2c3e50;
            border-radius: 15px;
            padding: 20px;
            color: white;
        }
        
        #log {
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
            background: #1a252f;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px solid #34495e;
        }
        
        .log-time {
            color: #3498db;
        }
        
        .log-priority {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .lane-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.8em;
            color: #bdc3c7;
        }
        
        .road-markings {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .road-line {
            position: absolute;
            background: white;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üö¶ H·ªá Th·ªëng ƒê√®n Giao Th√¥ng Th√¥ng Minh AI</h1>
            <div class="subtitle">Edge Computing & Artificial Intelligence trong qu·∫£n l√Ω giao th√¥ng ƒë√¥ th·ªã</div>
        </header>
        
        <div class="simulation-area">
            <div class="traffic-canvas-container">
                <canvas id="trafficCanvas" width="800" height="500"></canvas>
            </div>
            
            <div class="control-panel">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Chu K·ª≥ Hi·ªán T·∫°i</div>
                        <div class="stat-value" id="cycle">1</div>
                        <div class="stat-label">/<span id="maxCycle">10</span></div>
                    </div>
                    
                    <div class="stat-card">
<div class="stat-label">Xe ƒê√£ Qua</div>
                        <div class="stat-value" id="vehiclesPassed">0</div>
                        <div class="stat-label">Ph∆∞∆°ng Ti·ªán</div>
                    </div>
                </div>
                
                <div class="light-indicator">
                    <div class="stat-label">Tr·∫°ng Th√°i ƒê√®n</div>
                    <div class="light-state" id="stateDisplay">ƒê·ªé</div>
                    <div class="timer" id="timer">0.0s</div>
                    <div class="stat-label">Th·ªùi Gian C√≤n L·∫°i</div>
                </div>
                
                <div id="priorityDisplay" style="display: none;">
                    <div class="priority-alert">
                        <div style="font-size: 1.5em;">üö® ∆ØU TI√äN KH·∫®N C·∫§P</div>
                        <div id="priorityType" style="font-size: 1.2em; margin-top: 5px;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="log-container">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: white;">üìã Nh·∫≠t K√Ω H·ªá Th·ªëng</h3>
                <button onclick="clearLog()" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">X√≥a Log</button>
            </div>
            <div id="log"></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('trafficCanvas');
        const ctx = canvas.getContext('2d');
        
        // K√≠ch th∆∞·ªõc th·ª±c t·∫ø c·ªßa canvas
        const canvasWidth = 800;
        const canvasHeight = 500;
        
        // Thi·∫øt l·∫≠p k√≠ch th∆∞·ªõc hi·ªÉn th·ªã
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        
        // Bi·∫øn to√†n c·ª•c
        let simulationData = {};
        
        // V·∫Ω ƒë∆∞·ªùng v√† l√†n xe
        function drawRoad() {
            // M·∫∑t ƒë∆∞·ªùng
            ctx.fillStyle = '#34495e';
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // V·∫Ω v·∫°ch k·∫ª ƒë∆∞·ªùng gi·ªØa (lo·∫°i b·ªè v·∫°ch tr√™n c√πng)
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 15]);
            
            // Ch·ªâ v·∫Ω 2 v·∫°ch ph√¢n c√°ch gi·ªØa c√°c l√†n (thay v√¨ 3)
            for (let i = 1; i <= 2; i++) {
                const y = (canvasHeight / 3) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvasWidth, y);
                ctx.stroke();
            }
            
            ctx.setLineDash([]);
            
            // V·∫Ω v·∫°ch d·ª´ng
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(350, 0);
            ctx.lineTo(350, canvasHeight);
            ctx.stroke();
// V·∫Ω bi·ªÉn b√°o d·ª´ng
            ctx.fillStyle = 'red';
            ctx.font = '12px Arial';
            ctx.fillText('V·∫†CH D·ª™NG', 360, canvasHeight / 2);
        }
        
        // V·∫Ω ƒë√®n giao th√¥ng
        function drawTrafficLight(state) {
            const lightX = 700;
            const lightY = 50;
            const lightWidth = 80;
            const lightHeight = 200;
            
            // Th√¢n ƒë√®n
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(lightX, lightY, lightWidth, lightHeight);
            ctx.fillStyle = '#34495e';
            ctx.fillRect(lightX - 10, lightY + lightHeight, 100, 20);
            
            // ƒê√®n
            const lights = [
                { color: '#e74c3c', state: 'red', y: lightY + 20 },
                { color: '#f39c12', state: 'yellow', y: lightY + 80 },
                { color: '#27ae60', state: 'green', y: lightY + 140 }
            ];
            
            lights.forEach(light => {
                ctx.beginPath();
                ctx.arc(lightX + lightWidth/2, light.y, 25, 0, Math.PI * 2);
                ctx.fillStyle = light.state === state ? light.color : '#7f8c8d';
                ctx.fill();
                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
        }
        
        // V·∫Ω xe
        function drawCars(cars) {
            cars.forEach(car => {
                const x = car.position;
                const laneHeight = canvasHeight / 4;
                const y = 50 + (car.lane * laneHeight);
                
                // V·∫Ω xe b·∫±ng emoji
                ctx.font = '30px Arial';
                ctx.fillText(car.emoji, x, y);
                
                // Hi·ªÉn th·ªã th·ªùi gian ch·ªù n·∫øu xe ƒëang d·ª´ng
                if (car.waiting_time > 30) {
                    ctx.fillStyle = 'red';
                    ctx.font = '12px Arial';
                    ctx.fillText(`${car.waiting_time}s`, x, y - 10);
                }
            });
        }
        
        // C·∫≠p nh·∫≠t giao di·ªán
        function updateDisplay(data) {
            document.getElementById('cycle').textContent = data.current_cycle;
            document.getElementById('maxCycle').textContent = data.max_cycles;
            document.getElementById('vehiclesPassed').textContent = data.total_vehicles_passed || 0;
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë√®n
            const stateDisplay = document.getElementById('stateDisplay');
            stateDisplay.textContent = data.light_state.toUpperCase();
            stateDisplay.className = 'light-state state-' + data.light_state;
            
            // C·∫≠p nh·∫≠t timer
            document.getElementById('timer').textContent = data.remaining_time.toFixed(1) + 's';
            
            // C·∫≠p nh·∫≠t ∆∞u ti√™n
            const priorityDisplay = document.getElementById('priorityDisplay');
if (data.priority_active) {
                priorityDisplay.style.display = 'block';
                document.getElementById('priorityType').textContent = 
                    data.priority_type.toUpperCase() + ' ∆ØU TI√äN';
            } else {
                priorityDisplay.style.display = 'none';
            }
            
            // C·∫≠p nh·∫≠t log
            const logElement = document.getElementById('log');
            logElement.innerHTML = data.log.map(entry => 
                `<div class="log-entry"><span class="log-time">${entry.substring(1, 9)}</span> ${entry.substring(12)}</div>`
            ).join('');
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // V·∫Ω to√†n b·ªô c·∫£nh
        function drawScene(data) {
            // X√≥a canvas
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            
            // V·∫Ω c√°c th√†nh ph·∫ßn
            drawRoad();
            drawTrafficLight(data.light_state);
            drawCars(data.cars);
        }
        
        // L·∫•y d·ªØ li·ªáu t·ª´ server
        async function fetchData() {
            try {
                const response = await fetch('traffic_data.json?t=' + new Date().getTime());
                simulationData = await response.json();
                updateDisplay(simulationData);
                drawScene(simulationData);
            } catch (error) {
                console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
            }
        }
        
        // X√≥a log
        function clearLog() {
            const logElement = document.getElementById('log');
            logElement.innerHTML = '';
        }
        
        // B·∫Øt ƒë·∫ßu c·∫≠p nh·∫≠t
        setInterval(fetchData, 500);
        fetchData();
    </script>
</body>
</html>